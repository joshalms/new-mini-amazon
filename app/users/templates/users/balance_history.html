{% extends "base.html" %}

{% block content %}
<div class="container py-4" style="max-width: 960px;">
  <div class="card shadow-sm">
    <div class="card-body">
      <h3 class="card-title mb-3">Balance History</h3>
      <p class="text-muted">A running log of your recent balance transactions. Positive values are shown in green, withdrawals in red.</p>

      <div class="row text-center mb-4">
        <div class="col-md-3 col-6 mb-3">
          <div class="border rounded py-3">
            <div class="text-muted text-uppercase small">Current Balance</div>
            <div class="h4 text-success mb-0">{{ format_money(current_balance) }}</div>
          </div>
        </div>
        <div class="col-md-3 col-6 mb-3">
          <div class="border rounded py-3">
            <div class="text-muted text-uppercase small">Total Inflow</div>
            <div class="h4 text-success mb-0">{{ format_money(total_inflow) }}</div>
          </div>
        </div>
        <div class="col-md-3 col-6 mb-3">
          <div class="border rounded py-3">
            <div class="text-muted text-uppercase small">Total Outflow</div>
            <div class="h4 text-danger mb-0">-{{ format_money(total_outflow) }}</div>
          </div>
        </div>
        <div class="col-md-3 col-6 mb-3">
          <div class="border rounded py-3">
            <div class="text-muted text-uppercase small">Net Change</div>
            <div class="h4 {{ 'text-success' if net_change >= 0 else 'text-danger' }}">
              {{ '+' if net_change >= 0 else '-' }}{{ format_money(net_change|abs) }}
            </div>
          </div>
        </div>
      </div>

      {% if history %}
      <div class="table-responsive">
        <table class="table table-striped table-bordered">
          <thead class="thead-light">
            <tr>
              <th scope="col">Date</th>
              <th scope="col">Amount</th>
              <th scope="col">Note</th>
            </tr>
          </thead>
          <tbody>
            {% for entry in history %}
            {% set amt = entry.amount_cents %}
            <tr>
              <td>{{ entry.created_at.strftime('%b %d, %Y %I:%M %p') if entry.created_at else '' }}</td>
              <td class="{{ 'text-success font-weight-bold' if amt > 0 else 'text-danger font-weight-bold' if amt < 0 else '' }}">
                {{ '+' if amt > 0 else '' }}{{ format_money(amt) }}
              </td>
              <td>{{ entry.note }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
      <p class="text-muted mb-0">No historical transactions yet. Top up or withdraw funds from the dashboard to populate this view.</p>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
