{% extends "base.html" %}

{% block content %}
<h1>Top Products</h1>

<form id="top-k-form">
    <label for="k">Number of products:</label>
    <input type="number" name="k" id="k" min="1" value="1">
    <button type="submit">Show Top Products</button>
</form>

<table id="products-table" class="table table-hover table-bordered container">
    <tr>
        <th>Product Name</th>
        <th>Price</th>
        <th>Available</th>
    </tr>
</table>

<script>
async function fetchTopProducts(k=5) {
    const response = await fetch(`/api/products/topk?k=${k}`);
    const products = await response.json();
    const table = document.getElementById('products-table');

    // Reset header row
    table.innerHTML = `
        <tr>
            <th>Product Name</th>
            <th>Price</th>
            <th>Available</th>
        </tr>
    `;

    products.forEach(product => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${product.name}</td>
            <td>${product.price}</td>
            <td>${product.available ? 'Yes' : 'No'}</td>
        `;
        table.appendChild(row);
    });
}

// load default top products
fetchTopProducts();

document.getElementById('top-k-form').addEventListener('submit', (e) => {
    e.preventDefault();
    const k = document.getElementById('k').value;
    fetchTopProducts(k);
});
</script>
{% endblock %}