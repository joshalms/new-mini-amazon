{% extends "base.html" %}

{% block content %}
<div class="container" style="max-width: 720px; margin-top: 40px;">
  <div class="d-flex justify-content-between align-items-center flex-wrap">
    <h2 class="mb-0">{{ 'My' if g.user and g.user.id == owner_id else 'Seller' }} Inventory</h2>
    {% if owner_id and (not g.user or g.user.id != owner_id) %}
    <div class="text-muted small mt-2 mt-sm-0">User #{{ owner_id }}</div>
    {% endif %}
  </div>

  {% if inventory %}
  <p class="text-muted mb-1">
    Showing {{ inventory|length }} products.
  </p>
  {% endif %}

  {% if inventory %}
  <table class="table table-striped table-bordered mt-4">
    <thead class="thead-light">
      <tr>
        <th scope="col">Product</th>
        <th scope="col">Price</th>
        <th scope="col">Quantity</th>
        <th scope="col">Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for item in inventory %}
      <tr>
        <td>{{ item.name }}</td>
        <td>${{ '%.2f' % item.price }}</td>
        <td>{{ item.quantity }}</td>
        <td>
          <a href="{{ url_for('inventory.edit_product', user_id=owner_id, product_id=item.product_id) }}" class="btn btn-warning btn-sm">Edit</a>
          
          <form action="{{ url_for('inventory.remove_product', user_id=owner_id, product_id=item.product_id) }}" method="POST" style="display:inline;">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to remove this product?')">Remove</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <p class="mt-3">
    {{ 'You do not have' if g.user and g.user.id == owner_id else 'This seller does not have' }} any products for sale.
  </p>
  {% endif %}

  <!-- Pagination and Buttons Section -->
  <div class="mt-4 d-flex justify-content-between align-items-center">
    <!-- Add New Product Button -->
    <a href="{{ url_for('inventory.add_product', user_id=owner_id) }}" class="btn btn-primary">Add New Product</a>
    
    <!-- Pagination Controls -->
    <nav aria-label="Inventory pagination">
      <ul class="pagination justify-content-center">
        {% set prev_page = page - 1 %}
        {% set next_page = page + 1 %}
        <li class="page-item {{ 'disabled' if page <= 1 }}">
          <a class="page-link" href="{{ url_for('inventory.view_inventory', user_id=owner_id, page=prev_page if page > 1 else 1) }}">Previous</a>
        </li>
        <li class="page-item active">
          <span class="page-link">Page {{ page }} of {{ total_pages }}</span>
        </li>
        <li class="page-item {{ 'disabled' if page >= total_pages }}">
          <a class="page-link" href="{{ url_for('inventory.view_inventory', user_id=owner_id, page=next_page if page < total_pages else total_pages) }}">Next</a>
        </li>
      </ul>
    </nav>
    
    <!-- View Order History Button -->
    <a href="{{ url_for('inventory.view_orders', user_id=owner_id) }}" class="btn btn-primary">View Order History</a>
  </div>

</div>
{% endblock %}
